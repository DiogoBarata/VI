<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
	<div id="view"></div>
	<!-- <form>
		<div class="multiselect">
		  <div class="selectBox" onclick="showCheckboxes()">
			<select>
			  <option>Select an option</option>
			</select>
			<div class="overSelect"></div>
		  </div>
		  <div id="checkboxes">
			<label for="one">
			  <input type="checkbox" id="one" />First checkbox</label>
			<label for="two">
			  <input type="checkbox" id="two" />Second checkbox</label>
			<label for="three">
			  <input type="checkbox" id="three" />Third checkbox</label>
		  </div>
		</div>
	  </form> -->
</body>


<!-- <script>
	var expanded = false;

	function showCheckboxes() {
	var checkboxes = document.getElementById("checkboxes");
	if (!expanded) {
		checkboxes.style.display = "block";
		expanded = true;
	} else {
		checkboxes.style.display = "none";
		expanded = false;
	}
	}
</script>
<style>
.multiselect {
  width: 200px;
}

.selectBox {
  position: relative;
}

.selectBox select {
  width: 100%;
  font-weight: bold;
}

.overSelect {
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
}

#checkboxes {
  display: none;
  border: 1px #dadada solid;
}

#checkboxes label {
  display: block;
}

#checkboxes label:hover {
  background-color: #1e90ff;
}
</style> -->

<script>
	// Node content
	function renderNode(selection, rcd) {
		selection.append('input')
    		.attr('type', 'checkbox')
    		.on('change', function () {
      			d3.select('#selected')
				.text(checkboxValues(d3.select('#view')));
    		});
		selection.append('span')
    		.text(rcd.id);
	}
	// Return array of ids that is checked
	function checkboxValues(selection) {
		console.log(selection.select('.body')
			.selectAll('input:checked').data().map(d => d.id));
		return selection.select('.body')
			.selectAll('input:checked').data().map(d => d.id);
	}
	// Recursively append child nodes
	function nextLevel(selection, node) {
		const label = selection.append('span');
		const arrow = label.append('span').classed('arrow', true);
		label.call(renderNode, node.data);
		if (!node.hasOwnProperty('children')) return;
		const items = selection.append('ul')
			.style('list-style-type', 'none')
			.selectAll('li')
			.data(node.children, d => d.id);
		items.exit().remove();
		items.enter()
			.append('li').merge(items)
			.each(function (d) {
				d3.select(this).call(nextLevel, d);
			});
		label.select('.arrow')
			.text('▼ ')
			.on('click', function () {  // Collapse on click
				const childList = selection.select('ul');
				if (!childList.size()) return;
				const expanded = childList.style('display') !== 'none';
				d3.select(this).text(expanded ? '▶ ' : '▼ ');
				childList.style('display', expanded ? 'none' : 'inherit');
			});
	}
	// Generate tree view
	function tree(selection) {
		selection
			.classed('viewport', true)
			.style('overflow-y', 'scroll')
			.style('height', '500px')
			.append('div')
			.classed('body', true)
			.style('transform', 'scale(1.5)')
			.style('transform-origin', 'top left');
	}
	// Update tree data
	function updateTree(selection, items) {
		const root = d3.stratify()
			.id(d => d.id)
			.parentId(d => d.parent)(items);
		selection.select('.body')
			.call(nextLevel, root);
		// Remove dummy root node
		selection.select('.body > span').remove();
		selection.select('.body > ul').style('padding-left', 0);
	}
	var data = {
		"Classes": [
			{"id": "root"},
			{"id": "Classes", "parent":"root"},
			{"id": "Artificer", "parent": "Classes"},
			{"id": "Barbarian", "parent": "Classes"},
			{"id": "Bard", "parent": "Classes"},
			{"id": "Cleric", "parent": "Classes"},
			{"id": "Druid", "parent": "Classes"},
			{"id": "Fighter", "parent": "Classes"},
			{"id": "Monk", "parent": "Classes"},
			{"id": "Paladin", "parent": "Classes"},
			{"id": "Ranger", "parent": "Classes"},
			{"id": "Rogue", "parent": "Classes"},
			{"id": "Sorcerer", "parent": "Classes"},
			{"id": "Warlock", "parent": "Classes"},
			{"id": "Wizard", "parent": "Classes"}
		]
	}
	// Render
	d3.select('#view div').remove();
	d3.select('#view').append('div')
		.call(tree)
		.call(updateTree, data['Classes']);

</script>